var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Dictionary=function(){function t(){this.dict=[]}return t.prototype.add=function(t,e){var i=this.getValue(t);i?i._value=e:this.dict.push({_key:t,_value:e})},t.prototype.remove=function(t){var e=this.getIndex(t);return e>=0?(this.dict.splice(e,1),!0):!1},t.prototype.clear=function(){this.dict=[]},t.prototype.hasKey=function(t){return this.getIndex(t)>=0},t.prototype.getIndex=function(t){var e=this.dict.length;if(!e)return-1;for(var i=0;e>i;i++)if(this.dict[i]._key==t)return i;return-1},t.prototype.getValue=function(t){var e=this.dict.length;if(e)for(var i=0;e>i;i++)if(this.dict[i]._key==t)return this.dict[i]._value},t.prototype.foreach=function(t,e){this.dict&&0!=this.dict.length&&this.dict.forEach(function(i){t.call(e,i._value,i._key)})},Object.defineProperty(t.prototype,"keys",{get:function(){var t=new List;return this.dict.forEach(function(e){t.add(e._key)}),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){var t=new List;return this.dict.forEach(function(e){t.add(e._value)}),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"count",{get:function(){return this.dict.length},enumerable:!0,configurable:!0}),t}();__reflect(Dictionary.prototype,"Dictionary");var List=function(){function t(t){this.operArr=new Array,t&&(this.operArr=this.operArr.concat(t))}return t.prototype.add=function(t){return this.operArr.push(t),this.operArr},t.prototype.addRange=function(t){return this.operArr=this.operArr.concat(t),this.operArr},t.prototype.addListRange=function(t){return t&&t.count>0&&(this.operArr=this.operArr.concat(t.operArr)),this},t.prototype.clear=function(){this.operArr=[]},t.prototype.contains=function(t){if(this.count){var e=this.operArr.indexOf(t);return-1===e?!1:!0}return!1},t.prototype.find=function(t,e){if(this.count)for(var i=0;i<this.operArr.length;i++)if(t.call(e,this.operArr[i]))return this.operArr[i];return null},t.prototype.findAll=function(t,e){var i=new Array;return this.count&&this.operArr.forEach(function(r){t.call(e,r)&&i.push(r)}),i},t.prototype.findIndex=function(t,e){return this.count&&this.operArr.forEach(function(i,r){return t.call(e,i)?r:void 0}),-1},t.prototype.indexOf=function(t){return this.count&&this.operArr.forEach(function(e,i){return t===e?i:void 0}),-1},t.prototype.insert=function(t,e){this.operArr.splice(t,0,e)},t.prototype.insertRange=function(t,e){var i=this.operArr.slice(0,t+1),r=this.operArr.slice(t+1);return this.operArr=i.concat(e).concat(r),this.operArr},t.prototype.removeAll=function(t,e){var i=new Array;if(this.count)for(var r=this.count-1;r>=0;r--)t.call(e,this.operArr[r])&&(this.operArr.splice(r,1),i.push(this.operArr[r]));return i},t.prototype.removeItem=function(t){var e=this.indexOf(t);-1!=e&&this.operArr.splice(e,1)},t.prototype.removeAt=function(t){var e=this.getItem(t);e&&this.operArr.splice(t,1)},t.prototype.getItem=function(t){return this.count&&t>=0&&this.count>t?this.operArr[t]:null},t.prototype.setItem=function(t,e){this.count&&t>=0&&this.count>t&&(this.operArr[t]=e)},t.prototype.getRange=function(e,i){return new t(this.operArr.slice(e,i))},t.prototype.sort=function(t){return this.operArr.sort(t)},t.prototype.forEach=function(t,e){this.count&&this.operArr.forEach(function(i,r){t.call(e,i,r)})},t.prototype.toArray=function(){return this.operArr},t.prototype.toNewList=function(){return new t(this.operArr.slice(0))},Object.defineProperty(t.prototype,"count",{get:function(){return this.operArr.length},enumerable:!0,configurable:!0}),t}();__reflect(List.prototype,"List");var Item=function(t){function e(){var e=t.call(this)||this;return e.skinName="ItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.itemText.text=this.data.txt},e}(eui.ItemRenderer);__reflect(Item.prototype,"Item");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function r(r){e.call(i,r,t)}if(RES.hasRes(t)){var o=RES.getRes(t);o?r(o):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var FileModule;!function(t){function e(){hideFileLoad()}function i(){showFileLoad()}function r(){showEdit()}function o(){hideEdit()}var n,s,a,c=function(){function t(){}return t.prototype.sendFileData=function(t,e){if(n=t[0]){s||(s=egret.MainContext.instance.stage,a=new TestModule,s.addChild(a)),DataCenter.curFileData=n;var i=n.path,r=i.split(".").shift(),o=r.replace(/\\/g,"/"),c=o.match(/resource\/(\S*)/)[1];AssetsMgr.instance.loadSingleMovieFile("resource/"+c,function(t,i,r,o){DataCenter.curTestMc=t,a.initSkillModule(t,e,n.name,o)},this)}},t}();t.FileOper=c,__reflect(c.prototype,"FileModule.FileOper"),t.hideFile=e,t.showFile=i,t.showEffetEdit=r,t.hideEffectEdit=o}(FileModule||(FileModule={}));var PNGFILE=function(){function t(){}return t}();__reflect(PNGFILE.prototype,"PNGFILE");var MODULETYPE=function(){function t(){}return t}();MODULETYPE.ROLE="role",MODULETYPE.EFFECT="effect",MODULETYPE.WEAPON="weapon",MODULETYPE.EDIT="edit",__reflect(MODULETYPE.prototype,"MODULETYPE");var AssetsMgr=function(){function t(){this.assetDic=new Dictionary,this.skillGrouList=new List,this.g_map=[],this.g_isLoad=!0,this.g_groupName="",this.g_name=""}return t.prototype.init=function(){var t=this,e=RES.getGroupByName("skill");e.forEach(function(e){t.skillGrouList.add(e.name)},this)},t.prototype.loadGroup=function(t,e,i){if(!this.g_isLoad){var r={};return r._groupName=t,r._callBack=e,r._this=i,void this.g_map.push(r)}this.g_isLoad=!1,this.g_callback=e,this.g_thisArg=r;var o=!1;if(RES.isGroupLoaded(t)||(o=!0),o)RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.g_name=t,RES.loadGroup(t);else if(this.g_callback.call(this.g_thisArg),this.g_isLoad=!0,this.g_map.length){var n=this.g_map.shift();this.loadGroup(n._groupName,n._callBack,n._this)}},t.prototype.onResourceLoadComplete=function(t){if(egret.log("LoadComplete:"+t.groupName+" "),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.g_callback(this.g_thisArg),this.g_isLoad=!0,this.g_map.length){var e=this.g_map.shift();this.loadGroup(e._groupName,e._callback,e._this)}},t.prototype.onResourceLoadError=function(t){egret.warn("LoadError:"+t.groupName+" has failed to load")},t.prototype.onResourceProgress=function(t){if(t.groupName==this.g_name){var e=t.itemsLoaded/t.itemsTotal;egret.log(this.g_name+"  current===="+e.toFixed(0))}},t.prototype.loadSingleMovieFile=function(t,e,i,r){var o,n=new egret.MovieClipDataFactory,s=!1,a=!1,c=t.split("/").pop(),h={};RES.getResByUrl(t+".json",function(t){n.mcDataSet=t,a=!0,h=t,s&&(o=new egret.MovieClip(n.generateMovieClipData(c)),e.call(i,o,c,r,h))},this,RES.ResourceItem.TYPE_JSON),RES.getResByUrl(t+".png",function(t){n.texture=t,s=!0,a&&(o=new egret.MovieClip(n.generateMovieClipData(c)),e.call(i,o,c,r,h))},this,RES.ResourceItem.TYPE_IMAGE)},t.prototype.loadMovieGroup=function(t,e,i,r,o){for(var n=this,s=new Dictionary,a=i,c=1,h=9,l=0,u=1;h>u;u++){a=a.format(i,[e,u]);var d=t+a;this.hasMovieGroupRes("30300_a_"+u+"_png")?this.loadSingleMovieFile(d,function(t,e,i){s.add(i,t),c+=1,n.assetDic.add(e,t),c>=h-l&&(l=0,c=0,r.call(o,s))},this,u):(l+=1,c+=1)}},t.prototype.hasMovieGroupRes=function(t){var e=this.skillGrouList.find(function(e){return t===e});return e},t.prototype.loadSingleText=function(t,e,i){RES.getResByUrl(t,function(r){e&&e.call(i,r,t)},this,RES.ResourceItem.TYPE_JSON)},t.prototype.loadTextGroup=function(t,e,i,r,o){var n=this,s=new Dictionary,a=0,c=t.length,h=!0;t.forEach(function(t){n.loadSingleText(t,function(t,n){var l=n.split("/").pop().split(".").shift();return a++,s.add(l,t),r&&o&&r.call(o,t),h=!0,a>=c?(a=0,void e.call(i,s)):void 0},n)},this)},t.prototype.loadSinglePicture=function(t,e,i){var r=this;RES.getResByUrl(t,function(o){o=o;var n=t.split("/").pop().split(".").shift(),s=new egret.Bitmap(o);r.assetDic.add(n,s),e.call(i,s,n)},this,RES.ResourceItem.TYPE_IMAGE)},t.prototype.loadPictureGroup=function(t,e,i){var r=this,o=new Dictionary,n=0,s=t.length;t.forEach(function(t){r.loadSinglePicture(t,function(t,a){o.add(a,t),n+=1,r.assetDic.add(a,t),n>=s&&(n=0,e.call(i,o))},r)},this)},t.prototype.getAssets=function(t){var e=this.assetDic.getValue(t);return e},t.prototype.destoryAsset=function(t){this.assetDic.remove(t)},t}();AssetsMgr.instance=new AssetsMgr,__reflect(AssetsMgr.prototype,"AssetsMgr");var DataCenter=function(){function t(){}return t}();__reflect(DataCenter.prototype,"DataCenter");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this);var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},e.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.startCreateScene=function(){},e}(eui.UILayer);__reflect(Main.prototype,"Main");var TestModule=function(t){function e(){var e=t.call(this)||this;return e.dataObj={},e.delayTime=0,e.frameRate=0,e.NORMAL="normal",e.FILELIST="fileList",e.EDIT="edit",e.skinName="TestSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.skin.currentState=this.NORMAL,this.roleMc=new egret.MovieClip,this.effectMc=new egret.MovieClip,this.weaponMc=new egret.MovieClip,this.editMc=new egret.MovieClip,this.testModule.addChild(this.roleMc),this.testModule.addChild(this.weaponMc),this.testModule.addChild(this.effectMc),this.testModule.addChild(this.editMc),this.collect=new eui.ArrayCollection,this.list.itemRenderer=Item,this.list.dataProvider=this.collect,this.scroller.viewport=this.list,this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this,!1,2),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this,!1,1)},e.prototype.onItemTap=function(t){this.curItemIndex=t.itemIndex,this.curItem=this.list.getChildAt(t.itemIndex)},e.prototype.getCurrentState=function(){return this.skinState},e.prototype.onTouchTap=function(t){var e=this;if(this.skinState!=this.EDIT&&t.target.parent===this.btnGroup){if(!this.curRoleEffectName)return void alert("请加载技能资源");if(!this.curRoleModuleName)return void alert("请加载人物模型资源");if(!this.curRoleWeaponName)return void alert("请加载武器资源")}switch(t.target){case this.start:egret.clearInterval(this.interval);var i=this.editText.text;if(this.skinState===this.EDIT)return this.curEditMcName?void(this.interval=egret.setInterval(function(){e.frameRate=i?parseInt(i):e.frameRate,e.editMc.gotoAndPlay(1),e.editMc.frameRate=e.frameRate},this,1e3)):void alert("请加载特效资源");this.interval=egret.setInterval(function(){e.delayTime=i?parseInt(i):0,e.roleMc.gotoAndPlay(1),e.weaponMc.gotoAndPlay(1);var t=egret.setTimeout(function(){e.effectMc.gotoAndPlay(1),egret.clearTimeout(t)},e,e.delayTime);egret.setTimeout(function(){e.roleMc.gotoAndStop(1),e.weaponMc.gotoAndStop(1),e.effectMc.gotoAndStop(1)},e,e.playTime(e.roleMc))},this,1e3);break;case this.endAndSave:egret.clearInterval(this.interval),this.roleMc.gotoAndStop(1),this.effectMc.gotoAndStop(1),this.weaponMc.gotoAndStop(1),this.dataObj[this.curRoleModuleName]={skillId:this.curRoleEffectName,delayTime:this.delayTime,weaponId:this.curRoleWeaponName,clothId:this.curRoleModuleName},alert("保存成功");break;case this.end:if(egret.clearInterval(this.interval),this.skinState===this.EDIT)return this.curEditMcName?void this.editMc.gotoAndStop(1):void alert("请加载特效资源");this.roleMc.gotoAndStop(1),this.effectMc.gotoAndStop(1),this.weaponMc.gotoAndStop(1);break;case this.output:if(this.skinState===this.EDIT){if(!this.curEditMcName)return void alert("请加载特效资源");var r=this.curEditMcName.split(".").shift();return this.editJsonData.mc[r].frameRate=this.frameRate,void saveFile(JSON.stringify(this.editJsonData),r+".json")}saveFile(JSON.stringify(this.dataObj),"config.txt");break;case this.returnBtn:FileModule.showFile(),FileModule.hideEffectEdit(),this.curEditMcName="",this.testModule.removeChild(this.editMc),this.testModule.addChild(this.roleMc),this.testModule.addChild(this.weaponMc),this.testModule.addChild(this.effectMc),this.skinState=this.NORMAL,this.invalidateState();break;case this.fileList:var o=[];for(var n in this.dataObj){var s={txt:n+":=>"+JSON.stringify(this.dataObj[n])};o.push(s)}this.collect.source=o,this.skinState=this.FILELIST,this.invalidateState(),FileModule.hideFile(),FileModule.hideEffectEdit();break;case this.curItem?this.curItem.removeBtn:0:this.collect.removeItemAt(this.curItemIndex),this.collect.refresh();var a=-1;for(var n in this.dataObj)if(a+=1,a===this.curItemIndex){a=-1,delete this.dataObj[n];break}break;case this.clear:this.collect.replaceAll([]),this.collect.refresh(),this.dataObj=[];break;case this.editText:this.editText.text="";break;case this.edit:this.skinState=this.EDIT,this.testModule.removeChild(this.roleMc),this.testModule.removeChild(this.weaponMc),this.testModule.removeChild(this.effectMc),this.testModule.addChild(this.editMc),this.invalidateState(),FileModule.showEffetEdit(),FileModule.hideFile()}},e.prototype.initSkillModule=function(t,e,i,r){e===MODULETYPE.ROLE?(this.roleMc.movieClipData=t.movieClipData,this.curRoleModuleName=i,this.roleMc.x=(this.testModule.width>>1)-(this.roleMc.width>>1),this.roleMc.y=(this.testModule.height>>1)-this.roleMc.height):e===MODULETYPE.WEAPON?(this.weaponMc.movieClipData=t.movieClipData,this.curRoleWeaponName=i):e===MODULETYPE.EFFECT?(this.effectMc.movieClipData=t.movieClipData,this.curRoleEffectName=i):(this.skinState=this.EDIT,this.invalidateState(),this.editMc.movieClipData=t.movieClipData,this.curEditMcName=i,this.frameRate=t.frameRate,this.defaultFrame.text=t.frameRate+"",this.editJsonData=r),this.weaponMc.x=this.effectMc.x=this.roleMc.x,this.weaponMc.y=this.effectMc.y=this.roleMc.y},e.prototype.playTime=function(t){return t.movieClipData?1/t.frameRate*t.totalFrames*1e3:0},e}(eui.Component);__reflect(TestModule.prototype,"TestModule");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,r){function o(t){e.call(r,t)}function n(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),i.call(r))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);